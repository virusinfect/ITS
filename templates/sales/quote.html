{% extends "base.html" %}
{% block title %}Quote{% endblock %}
{% block header %}Quote{% endblock %}
{% load static %}
{% block content %}
    <div class=" card col-8 mx-auto wrapper px-2">
        <!-- Main content -->
        <section class="card invoice" id="delivery-note">
            <div id="content">

                <div class="page-header">
                    <div class="d-flex justify-content-center mb-1 mt-1">
                        <img src="{% static 'logo black.png' %}" height="125" width="125">
                    </div>
                </div>

                <table class="table table-borderless">
                    <thead>
                    <tr>
                        <td>
                            <!--place holder for the fixed-position header-->
                            <div class="page-header-space"></div>
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <div class="page">
                                <div class="row">
                                    <div class="col-6 text-start">
                                        <p>{{ quote.company.name }}</p>
                                        <p>{{ quote.company.address }}</p>
                                    </div>
                                    <div class="col-6 text-end">
                                        <p>DATE: {{ quote.created|date:"d/m/Y" }}</p>
                                        <p>OUR REF: ITLQ/{{ quote.updated|date:"m/Y" }}-{{ quote.sq_id }}</p>
                                    </div>
                                </div>
                                <table class="table table-bordered layout-fixed">
                                    <tbody>
                                    <tr>
                                        <td class=" d-flex justify-content-center"><strong>RE: QUOTATION</strong></td>
                                    </tr>
                                    </tbody>
                                </table>
                                <p>{{ quote.mail_text|safe }}</p>
                                {% if quote.layout == "Grouped" %}
                                    <table class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th style="width: 20%; text-transform: uppercase;">Part No.</th>
                                            <th style="width: 40%; text-transform: uppercase;">Description</th>
                                            <th style="width: 20%; text-transform: uppercase;">Availability</th>
                                            <th style="width: 10%; text-transform: uppercase; text-align: center;">
                                                Price
                                            </th>
                                            <th style="width: 10%; text-transform: uppercase; text-align: center;">Qty
                                            </th>
                                            <th style="width: 10%; text-transform: uppercase; text-align: center;">
                                                Price
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for item in items %}
                                            <tr>
                                                <td>{{ item.part_no }}</td>
                                                <td>{{ item.description }}</td>
                                                <td>{{ item.availability }}</td>
                                                <td style="text-align: center;">{{ item.price }}</td>
                                                <td style="text-align: center;">{{ item.quantity }}</td>
                                                <td style="text-align: right;">{{ item.total }}</td>
                                            </tr>
                                        {% endfor %}
                                        <tr>
                                            <th colspan="5" style="text-align: right;">SUB TOTALS</th>
                                            <td style="text-align: right;">{{ subtotals }}</td>
                                        </tr>
                                        <tr>
                                            <th class="text-danger" colspan="5" style="text-align: right;">ADD VAT 16%
                                            </th>
                                            <td class="text-danger"
                                                style="text-align: right;">{{ vat }}</td>
                                        </tr>
                                        <tr>
                                            <th class="" colspan="5" style="text-align: right;">TOTAL AMOUNT</th>
                                            <td style="text-align: right;">{{ total_amount }}</td>
                                        </tr>

                                        </tbody>
                                    </table>

                                {% endif %}
                                {% if quote.layout == "Classified" %}
                                     {% for item in items %}
                                        <table class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th style="width: 20%; text-transform: uppercase;">Part No.</th>
                                            <th style="width: 40%; text-transform: uppercase;">Description</th>
                                            <th style="width: 20%; text-transform: uppercase;">Availability</th>
                                            <th style="width: 10%; text-transform: uppercase; text-align: center;">
                                                Price
                                            </th>
                                            <th style="width: 5%; text-transform: uppercase; text-align: center;">Qty
                                            </th>
                                            <th style="width: 20%; text-transform: uppercase; text-align: center;">
                                                Price
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>{{ item.part_no }}</td>
                                            <td>{{ item.description }}</td>
                                            <td>{{ item.availability }}</td>
                                            <td style="text-align: center;">{{ item.price }}</td>
                                            <td style="text-align: center;">{{ item.quantity }}</td>
                                            <td style="text-align: right;">{{ item.total }}</td>
                                        </tr>
                                        <tr>
                                            <th colspan="5" style="text-align: right;">SUB TOTALS</th>
                                            <td style="text-align: right;">{{ item.total }}</td>
                                        </tr>
                                        <tr>
                                            <th class="text-danger" colspan="5" style="text-align: right;">ADD VAT 16%
                                            </th>
                                            <td class="text-danger"
                                                style="text-align: right;">{{ item.vat }}</td>
                                        </tr>
                                        <tr>
                                            <th class="" colspan="5" style="text-align: right;">TOTAL AMOUNT</th>
                                            <td style="text-align: right;">{{ item.total_amount }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                                </table>

                                {% endif %}
                                {% if quote.layout == "Separated" %}
                                    {% for item in items %}
                                        <table class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th style="width: 20%; text-transform: uppercase;">Part No.</th>
                                            <th style="width: 40%; text-transform: uppercase;">Description</th>
                                            <th style="width: 20%; text-transform: uppercase;">Availability</th>
                                            <th style="width: 10%; text-transform: uppercase; text-align: center;">
                                                Price
                                            </th>
                                            <th style="width: 5%; text-transform: uppercase; text-align: center;">Qty
                                            </th>
                                            <th style="width: 20%; text-transform: uppercase; text-align: center;">
                                                Price
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>{{ item.part_no }}</td>
                                            <td>{{ item.description }}</td>
                                            <td>{{ item.availability }}</td>
                                            <td style="text-align: center;">{{ item.price }}</td>
                                            <td style="text-align: center;">{{ item.quantity }}</td>
                                            <td style="text-align: right;">{{ item.total }}</td>
                                        </tr>
                                        <tr>
                                            <th colspan="5" style="text-align: right;">SUB TOTALS</th>
                                            <td style="text-align: right;">{{ item.total }}</td>
                                        </tr>
                                        <tr>
                                            <th class="text-danger" colspan="5" style="text-align: right;">ADD VAT 16%
                                            </th>
                                            <td class="text-danger"
                                                style="text-align: right;">{{ item.vat }}</td>
                                        </tr>
                                        <tr>
                                            <th class="" colspan="5" style="text-align: right;">TOTAL AMOUNT</th>
                                            <td style="text-align: right;">{{ item.total_amount }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                                </table>

                                {% endif %}


                                {{ quote.footer_note|safe }}

                            </div> <!-- /. page -->

                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <img src="{% static 'tr_footer.png' %}" id="footer-image" class="mb-1">
        </section>

    </div>
    <a type="button" class="btn btn-primary waves-effect waves-light  me-1" id="print-button">
        <span class="btn-label"><i class="mdi mdi-printer"></i></span>Print
    </a>
    <script>
        document.getElementById('print-button').addEventListener('click', function () {
            printDeliveryNote();
        });

        function printDeliveryNote() {
            var printContents = document.getElementById('delivery-note').innerHTML; // 'delivery-note' is the ID of the content to print
            var originalContents = document.body.innerHTML;

            // Create a style tag and append it to the head to define a CSS rule for the footer image and remove margins
            var style = document.createElement('style');
            style.innerHTML = `
            @media print {
                #footer-image {
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    max-width: 98%;
                }
                body {
                    margin: 0 !important; /* Force margin removal */
                }
            }
        `;
            document.head.appendChild(style);

            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;

            // Remove the added CSS rule
            document.head.removeChild(style);
        }
    </script>
{% endblock %}